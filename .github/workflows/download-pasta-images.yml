# .github/workflows/download-pasta-images.yml
# -----------------------------------------------------------------------------
# PURPOSE
# - Downloads images from tools/pasta-images-downloader/manifest.csv
# - Saves them under uncooked/ and cooked/
# - Creates pasta-images.zip
# - ALWAYS uploads:
#     1) pasta-images.zip (even if some downloads fail)
#     2) download-log.txt (so you can see which URLs failed)
# -----------------------------------------------------------------------------

name: Download Pasta Images

on:
  workflow_dispatch:

jobs:
  download-images:
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: 24

      # Run the downloader, but DON'T fail the job if some URLs error out.
      # We capture output to a log so you can inspect failures afterward.
      - name: Download images + build pasta-images.zip (capture log)
        working-directory: tools/pasta-images-downloader
        continue-on-error: true
        run: |
          node ./download_images.js | tee download-log.txt

      # Upload the zip if it exists (this is what you actually want).
      - name: Upload pasta-images.zip artifact
        uses: actions/upload-artifact@v4
        with:
          name: pasta-images-zip
          path: tools/pasta-images-downloader/pasta-images.zip
          if-no-files-found: error
          retention-days: 7

      # Upload the log no matter what - it will show any failing URLs.
      - name: Upload download log artifact
        uses: actions/upload-artifact@v4
        with:
          name: pasta-images-download-log
          path: tools/pasta-images-downloader/download-log.txt
          if-no-files-found: warn
          retention-days: 7
