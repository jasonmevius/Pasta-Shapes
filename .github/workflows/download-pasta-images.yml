# .github/workflows/download-pasta-images.yml
# -----------------------------------------------------------------------------
# PURPOSE
# - Runs the pasta image downloader on a GitHub-hosted runner (no local installs)
# - Downloads all images referenced in tools/pasta-images-downloader/manifest.csv
# - Writes them to:
#     tools/pasta-images-downloader/uncooked/<slug>.<ext>
#     tools/pasta-images-downloader/cooked/<slug>.<ext>
# - Creates:
#     tools/pasta-images-downloader/pasta-images.zip
# - Uploads pasta-images.zip as a downloadable Actions Artifact
#
# HOW TO USE
# - Go to the repo - Actions tab - "Download Pasta Images" - Run workflow
# - When the run completes, download the artifact from the run summary page
# -----------------------------------------------------------------------------

name: Download Pasta Images

on:
  # Manual trigger - you run it when you want a fresh zip.
  workflow_dispatch:

jobs:
  download-images:
    runs-on: ubuntu-latest

    # Least privilege - this job only needs to read the repo contents.
    permissions:
      contents: read

    steps:
      # Pull the repo contents into the runner workspace.
      - name: Checkout repository
        uses: actions/checkout@v4

      # Install Node on the runner so we can run download_images.js.
      # setup-node v6 is current and supports modern Node on GitHub runners. :contentReference[oaicite:0]{index=0}
      - name: Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: 24

      # Run the downloader from its folder so paths resolve cleanly.
      - name: Download images + build pasta-images.zip
        working-directory: tools/pasta-images-downloader
        run: |
          node ./download_images.js

      # Upload the generated zip as an Actions Artifact.
      # Note: GitHub stores artifacts as a zip internally; uploading our zip simply
      # means you'll download an artifact that contains pasta-images.zip inside it. :contentReference[oaicite:1]{index=1}
      - name: Upload pasta-images.zip artifact
        uses: actions/upload-artifact@v4
        with:
          name: pasta-images-zip
          path: tools/pasta-images-downloader/pasta-images.zip
          if-no-files-found: error

          # Keep storage low - artifacts default to 90 days, but we only need it short-term. :contentReference[oaicite:2]{index=2}
          retention-days: 7
