---
title: Pasta Shapes
layout: layout.njk
description: "Search pasta shapes by name and aliases, or identify a shape by answering a few quick questions."
---

{# =============================================================================
  index.njk (Homepage - Search)
  ------------------------------------------------------------------------------
  PURPOSE
  - Mobile-first homepage optimized for the restaurant use case:
      - Type a pasta name (from a menu)
      - See matching shapes quickly
      - Tap into the detail page if needed

  IMPORTANT
  - NO inline CSS. Styling lives in /src/css/styles.css

  THUMBNAILS (WHY THIS FILE CHANGED)
  - Your rendered homepage HTML showed:
      <span class="thumb"></span>
    ...with NO <img>, which produces grey boxes.
  - Identify page shows thumbs because its JS injects images there.
  - This template now renders an <img> inside .thumb for each result.

  NOTE ON NUNJUCKS FILTERS
  - Your environment does NOT provide a `split` filter.
  - So we avoid `split("/") | last` and instead strip known prefixes using `replace`.
============================================================================= #}

{# -----------------------------------------------------------------------------
  ImageKit configuration for list thumbnails
  - You can change the folder in one place later if needed.
----------------------------------------------------------------------------- #}
{% set IK_THUMBS_BASE = "https://ik.imagekit.io/mevius/pasta/thumbs/" %}
{% set FALLBACK_THUMB = "pending.png" %}

<section class="hero stack">
  <h1 class="h1">Pasta Shapes</h1>

  <p class="muted lead">
    Type a pasta name from a menu to see matches (including common aliases).
    If you have a pasta shape in front of you, use Identify to narrow it down by questions.
  </p>
</section>

<section class="card stack" aria-label="Search pasta shapes">
  {# ---------------------------------------------------------------------------
    Search form
    - JS filters the list live as you type.
  --------------------------------------------------------------------------- #}
  <form id="pasta-search-form" class="search" action="/" method="get">
    <label class="sr-only" for="pasta-q">Search</label>
    <input
      id="pasta-q"
      name="q"
      class="search-input"
      type="search"
      inputmode="search"
      autocomplete="off"
      autocapitalize="none"
      spellcheck="false"
      placeholder="Start typing - e.g., ravioli, rigatoni, bucatini"
    />
  </form>

  <div class="results-head">
    <h2 class="h2">Results</h2>
    <p id="pasta-search-status" class="muted" aria-live="polite">
      Start typing to see matches.
    </p>
  </div>

  {# Suggestions (empty by default; JS may populate later) #}
  <ul id="pasta-search-suggestions" class="suggestions" aria-label="Suggestions"></ul>

  {# Recently viewed (per-browser; JS populates) #}
  <div id="recently-viewed-wrap" class="recent-wrap" hidden>
    <h3 class="h3">Recently viewed</h3>
    <p id="recently-viewed" class="muted"></p>
  </div>

  {# ---------------------------------------------------------------------------
    Results list
    - Server-rendered so thumbnails and content exist even without JS.
    - JS simply shows/hides items.
  --------------------------------------------------------------------------- #}
  <ul id="pasta-results" class="results-list" aria-label="Pasta results">
    {% for item in pasta %}

      {# -----------------------------------------------------------------------
        "Also" line (aliases)
        - Pick the first existing field that matches your dataset.
      ----------------------------------------------------------------------- #}
      {% set alsoRaw =
        item.SearchAliases
        or item.Aliases
        or item.Synonyms
        or item.Also
        or item.Misspellings
        or ""
      %}

      {# -----------------------------------------------------------------------
        THUMBNAIL URL NORMALIZATION (NO split FILTER!)

        item.ThumbnailImage may be:
          1) empty
          2) filename: "penne.png"
          3) full URL: "https://ik.imagekit.io/.../penne.png"
          4) older string containing "<ImageKitPath>"

        We normalize using only safe operations:
          - replace
          - trim
          - startsWith (string method available in your Nunjucks runtime)

        Strategy:
          A) If empty -> use FALLBACK_THUMB in IK_THUMBS_BASE
          B) If starts with http -> use as-is
          C) Else -> treat as a filename (or relative path) and append to IK_THUMBS_BASE
              - But first strip common prefixes if present, so we don't double-prefix.
      ----------------------------------------------------------------------- #}

      {# Raw thumb string from data (cleaned) #}
      {% set thumbRaw = (item.ThumbnailImage or "") | replace("<ImageKitPath>", "") | trim %}

      {# Determine if it's a full URL #}
      {% set thumbIsUrl = thumbRaw and thumbRaw.startsWith("http") %}

      {# If it's not a URL, clean it to be a simple filename/relative path #}
      {% set thumbClean = thumbRaw %}
      {% if thumbClean %}
        {# Strip ImageKit base if someone pasted full path without http #}
        {% set thumbClean = thumbClean | replace("https://ik.imagekit.io/mevius/pasta/thumbs/", "") %}
        {% set thumbClean = thumbClean | replace("https://ik.imagekit.io/mevius/", "") %}

        {# Strip known folder prefixes so we can safely re-add IK_THUMBS_BASE #}
        {% set thumbClean = thumbClean | replace("/pasta/thumbs/", "") %}
        {% set thumbClean = thumbClean | replace("pasta/thumbs/", "") %}
        {% set thumbClean = thumbClean | replace("/thumbs/", "") %}
        {% set thumbClean = thumbClean | replace("thumbs/", "") %}
      {% endif %}

      {# Build the final URL #}
      {% if not thumbRaw %}
        {% set thumbUrl = IK_THUMBS_BASE ~ FALLBACK_THUMB %}
      {% elseif thumbIsUrl %}
        {% set thumbUrl = thumbRaw %}
      {% else %}
        {% set thumbUrl = IK_THUMBS_BASE ~ thumbClean %}
      {% endif %}

      {# ImageKit transform for small list thumbnails #}
      {% set thumbUrlTransformed = thumbUrl ~ "?tr=w-112,h-112,f-auto,q-50" %}

      <li class="result-card" data-slug="{{ item.Slug }}" data-search="">
        <a class="result-link" href="/pasta/{{ item.Slug }}/" data-recent="1">
          {# Thumbnail container - decorative, since name text is present #}
          <span class="thumb" aria-hidden="true">
            <img
              src="{{ thumbUrlTransformed }}"
              alt=""
              loading="lazy"
              decoding="async"
            />
          </span>

          <span class="result-body">
            <span class="result-title-row">
              <span class="result-name">{{ item.ShapeName }}</span>
            </span>

            {% if alsoRaw %}
              <span class="result-also muted">
                Also: {{ alsoRaw }}
              </span>
            {% endif %}
          </span>
        </a>
      </li>
    {% endfor %}
  </ul>

  {# Footer tools for paging (JS controls visibility/text) #}
  <div class="results-tools">
    <p id="pasta-results-note" class="muted"></p>
    <button id="pasta-toggle-all" class="btn secondary btn-small" type="button" hidden>
      Next 10
    </button>
  </div>
</section>
