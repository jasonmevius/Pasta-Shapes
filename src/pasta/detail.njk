---
pagination:
  data: pasta
  size: 1
  alias: item
permalink: "pasta/{{ item.Slug }}/index.html"
layout: layout.njk

eleventyComputed:
  title: "Pasta Shapes: {{ item.ShapeName }}"
  description: "{% if item.Synonyms %}Aliases: {{ item.Synonyms | truncate(140) }}{% else %}What {{ item.ShapeName }} looks like, plus key shape attributes.{% endif %}"
---

{# =============================================================================
  detail.njk
  ------------------------------------------------------------------------------
  PURPOSE
  - Individual pasta detail page optimized for Mobile (fast scan + high ROI info).
  - Sections included (per your prioritization):
      1) Key tells
      2) Commonly confused with (+ why)
      3) Substitutes (ranked + why)
      4) Pairings (+ why)
      6) Aliases / synonyms
    Plus: lightweight "How it's made" and "Attributes" reference (collapsed).

  COMPATIBILITY
  - Avoids non-standard filters like `map` / `reject` that are not available in
    your Eleventy/Nunjucks environment by default.

  LIST FIELD CONVENTION
  - Semicolon-separated strings: "A; B; C"
  - Matching Why lists should have the same order and count.

  LINKING BEHAVIOR
  - Attempts to link related pastas by matching `ShapeName` to an entry in `pasta`.
  - Falls back to plain text if not found.
============================================================================= #}

{% set heroUrl = item.ThumbnailImage | pastaHeroUrl(item.PhotoImage) %}
{% set SEP = ";" %}

{# -----------------------------------------------------------------------------
  Build arrays using only built-in `split` and simple loops (no map/reject).
----------------------------------------------------------------------------- #}

{# Key tells array #}
{% set keyTellsRaw = item.KeyTells or "" %}
{% set keyTellsSplit = keyTellsRaw | split(SEP) %}
{% set keyTells = [] %}
{% for v in keyTellsSplit %}
  {% set tPP = (v or "") | trim %}
  {% if T != "" %}
    {% set keyTells = keyTells.concat([T]) %}
  {% endif %}
{% endfor %}

{# Confused-with arrays #}
{% set confusedRaw = item.OftenConfusedWith or "" %}
{% set confusedSplit = confusedRaw | split(SEP) %}
{% set confused = [] %}
{% for v in confusedSplit %}
  {% set T = (v or "") | trim %}
  {% if T != "" %}
    {% set confused = confused.concat([T]) %}
  {% endif %}
{% endfor %}

{% set confusedWhyRaw = item.OftenConfusedWithWhy or "" %}
{% set confusedWhySplit = confusedWhyRaw | split(SEP) %}
{% set confusedWhy = [] %}
{% for v in confusedWhySplit %}
  {% set T = (v or "") | trim %}
  {% if T != "" %}
    {% set confusedWhy = confusedWhy.concat([T]) %}
  {% endif %}
{% endfor %}

{# Pairings arrays #}
{% set pairingsRaw = item.ClassicSaucePairings or "" %}
{% set pairingsSplit = pairingsRaw | split(SEP) %}
{% set pairings = [] %}
{% for v in pairingsSplit %}
  {% set T = (v or "") | trim %}
  {% if T != "" %}
    {% set pairings = pairings.concat([T]) %}
  {% endif %}
{% endfor %}

{% set pairingsWhyRaw = item.ClassicSaucePairingsWhy or "" %}
{% set pairingsWhySplit = pairingsWhyRaw | split(SEP) %}
{% set pairingsWhy = [] %}
{% for v in pairingsWhySplit %}
  {% set T = (v or "") | trim %}
  {% if T != "" %}
    {% set pairingsWhy = pairingsWhy.concat([T]) %}
  {% endif %}
{% endfor %}

{# Substitutes (single values for v1) #}
{% set subClosest = (item.SubstitutesClosest or "") | trim %}
{% set subDecent = (item.SubstitutesDecent or "") | trim %}
{% set subEmergency = (item.SubstitutesEmergency or "") | trim %}

{% set subClosestWhy = (item.SubstitutesClosestWhy or "") | trim %}
{% set subDecentWhy = (item.SubstitutesDecentWhy or "") | trim %}
{% set subEmergencyWhy = (item.SubstitutesEmergencyWhy or "") | trim %}

{# Section presence flags #}
{% set hasKeyTells = (keyTells | length) > 0 %}
{% set hasConfused = (confused | length) > 0 %}
{% set hasPairings = (pairings | length) > 0 %}
{% set hasSubs = (subClosest != "") or (subDecent != "") or (subEmergency != "") %}
{% set hasHistory = (item.HistoryBlurb or "") | trim != "" %}

{% set showJump = (hasKeyTells and hasConfused) or (hasPairings and hasSubs) or (hasHistory and hasPairings) %}

<a class="skip-link" href="#main">Skip to content</a>

<nav class="breadcrumbs">
  <a href="/">← Back to search</a>
</nav>

<main id="main" class="stack">
  {# ---------------------------------------------------------------------------
    Header
  --------------------------------------------------------------------------- #}
  <header class="stack tight">
    <h1 class="h1">{{ item.ShapeName }}</h1>
    {% if item.Category %}
      <p class="muted">{{ item.Category }}</p>
    {% endif %}
  </header>

  {# ---------------------------------------------------------------------------
    Hero image
  --------------------------------------------------------------------------- #}
  <figure class="card hero">
    <img
      src="{{ heroUrl }}"
      alt="{{ item.ShapeName }}"
      width="1200"
      height="1200"
      loading="eager"
      decoding="async"
    />
  </figure>

  {# ---------------------------------------------------------------------------
    Jump nav (optional)
  --------------------------------------------------------------------------- #}
  {% if showJump %}
    <section class="card stack tight" aria-label="Jump to sections">
      <h2 class="h2">Jump to</h2>
      <p class="muted">
        {% if hasKeyTells %}<a href="#key-tells">Key tells</a>{% endif %}
        {% if hasConfused %} · <a href="#confused-with">Confused with</a>{% endif %}
        {% if hasPairings %} · <a href="#pairings">Pairings</a>{% endif %}
        {% if hasSubs %} · <a href="#substitutes">Substitutes</a>{% endif %}
        {% if item.Synonyms %} · <a href="#aliases">Aliases</a>{% endif %}
        {% if hasHistory %} · <a href="#history">History</a>{% endif %}
        · <a href="#attributes">Attributes</a>
      </p>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    Description (short)
  --------------------------------------------------------------------------- #}
  {% set desc = "" %}
  {% if item.Description %}
    {% set desc = item.Description %}
  {% elif item.KeyDiscriminators %}
    {% set desc = item.KeyDiscriminators %}
  {% endif %}

  {% if desc %}
    <section class="card stack tight" aria-label="Description">
      <h2 class="h2">What it is</h2>
      <p class="muted">{{ desc }}</p>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    Key tells
  --------------------------------------------------------------------------- #}
  {% if hasKeyTells %}
    <section id="key-tells" class="card stack" aria-label="Key tells">
      <h2 class="h2">Key tells</h2>
      <ul class="attr-list">
        {% for t in keyTells %}
          <li>{{ t }}</li>
        {% endfor %}
      </ul>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    Commonly confused with
  --------------------------------------------------------------------------- #}
  {% if hasConfused %}
    <section id="confused-with" class="card stack" aria-label="Commonly confused with">
      <h2 class="h2">Commonly confused with</h2>

      <ul class="stack tight">
        {% for name in confused %}
          {% set match = (pasta | selectattr("ShapeName", "equalto", name) | first) %}
          <li class="stack tight">
            {% if match and match.Slug %}
              <a href="/pasta/{{ match.Slug }}/">{{ name }}</a>
            {% else %}
              <span>{{ name }}</span>
            {% endif %}

            {# Use the same index into confusedWhy when present #}
            {% if confusedWhy[loop.index0] %}
              <p class="muted">{{ confusedWhy[loop.index0] }}</p>
            {% endif %}
          </li>
        {% endfor %}
      </ul>

      <p class="muted">
        Tip: If you’re not sure, try <a href="/identify/">Identify</a> and narrow it down by shape.
      </p>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    Pairings
  --------------------------------------------------------------------------- #}
  {% if hasPairings %}
    <section id="pairings" class="card stack" aria-label="Pairings">
      <h2 class="h2">Pairings</h2>

      <ul class="stack tight">
        {% for p in pairings %}
          <li class="stack tight">
            <strong>{{ p }}</strong>
            {% if pairingsWhy[loop.index0] %}
              <p class="muted">{{ pairingsWhy[loop.index0] }}</p>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    Substitutes
  --------------------------------------------------------------------------- #}
  {% if hasSubs %}
    <section id="substitutes" class="card stack" aria-label="Substitutes">
      <h2 class="h2">Substitutes</h2>

      <ul class="stack tight">
        {% if subClosest != "" %}
          <li class="stack tight">
            <strong>Closest:</strong>
            {% set m1 = (pasta | selectattr("ShapeName", "equalto", subClosest) | first) %}
            {% if m1 and m1.Slug %}
              <a href="/pasta/{{ m1.Slug }}/">{{ subClosest }}</a>
            {% else %}
              <span>{{ subClosest }}</span>
            {% endif %}
            {% if subClosestWhy != "" %}
              <p class="muted">{{ subClosestWhy }}</p>
            {% endif %}
          </li>
        {% endif %}

        {% if subDecent != "" %}
          <li class="stack tight">
            <strong>Decent:</strong>
            {% set m2 = (pasta | selectattr("ShapeName", "equalto", subDecent) | first) %}
            {% if m2 and m2.Slug %}
              <a href="/pasta/{{ m2.Slug }}/">{{ subDecent }}</a>
            {% else %}
              <span>{{ subDecent }}</span>
            {% endif %}
            {% if subDecentWhy != "" %}
              <p class="muted">{{ subDecentWhy }}</p>
            {% endif %}
          </li>
        {% endif %}

        {% if subEmergency != "" %}
          <li class="stack tight">
            <strong>Emergency:</strong>
            {% set m3 = (pasta | selectattr("ShapeName", "equalto", subEmergency) | first) %}
            {% if m3 and m3.Slug %}
              <a href="/pasta/{{ m3.Slug }}/">{{ subEmergency }}</a>
            {% else %}
              <span>{{ subEmergency }}</span>
            {% endif %}
            {% if subEmergencyWhy != "" %}
              <p class="muted">{{ subEmergencyWhy }}</p>
            {% endif %}
          </li>
        {% endif %}
      </ul>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    How it's made (lightweight)
  --------------------------------------------------------------------------- #}
  {% if item.MadeMethod %}
    <section class="card stack tight" aria-label="How it's made">
      <h2 class="h2">How it’s made</h2>
      <p class="muted">{{ item.MadeMethod }}</p>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    Aliases
  --------------------------------------------------------------------------- #}
  {% if item.Synonyms %}
    <section id="aliases" class="card stack tight" aria-label="Also known as">
      <h2 class="h2">Also known as</h2>
      <p class="muted">{{ item.Synonyms }}</p>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    History
  --------------------------------------------------------------------------- #}
  {% if item.HistoryBlurb %}
    <section id="history" class="card stack tight" aria-label="History">
      <h2 class="h2">History</h2>
      <p class="muted">{{ item.HistoryBlurb }}</p>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    Attributes (collapsible)
  --------------------------------------------------------------------------- #}
  <section id="attributes" class="card stack" aria-label="Shape attributes">
    <h2 class="h2">Shape attributes</h2>

    <details>
      <summary class="muted">View full attribute list</summary>

      <ul class="attr-list">
        {% if item.Type %}<li><strong>Type:</strong> {{ item.Type }}</li>{% endif %}
        {% if item.PrimaryGeometry %}<li><strong>Primary geometry:</strong> {{ item.PrimaryGeometry }}</li>{% endif %}
        {% if item.SizeClass %}<li><strong>Size:</strong> {{ item.SizeClass }}</li>{% endif %}

        {% if item.IsHollow %}<li><strong>Hollow:</strong> {{ item.IsHollow }}</li>{% endif %}
        {% if item.IsRidged %}<li><strong>Ridged:</strong> {{ item.IsRidged }}</li>{% endif %}
        {% if item.IsTwisted %}<li><strong>Twisted:</strong> {{ item.IsTwisted }}</li>{% endif %}
        {% if item.IsCurved %}<li><strong>Curved:</strong> {{ item.IsCurved }}</li>{% endif %}
        {% if item.IsStuffed %}<li><strong>Stuffed:</strong> {{ item.IsStuffed }}</li>{% endif %}

        {% if item.CityOrRegionMostAssociated and item.CityOrRegionMostAssociated != "Unknown" %}
          <li><strong>City/Region:</strong> {{ item.CityOrRegionMostAssociated }}</li>
        {% endif %}

        {% if item.EarliestAttestedMention and item.EarliestAttestedMention != "Unknown" %}
          <li><strong>Earliest mention:</strong> {{ item.EarliestAttestedMention }}</li>
        {% endif %}

        {% if item.SourceLink %}
          <li>
            <strong>Source:</strong>
            <a href="{{ item.SourceLink }}" rel="noopener">Link</a>
          </li>
        {% endif %}
      </ul>
    </details>
  </section>

  {# ---------------------------------------------------------------------------
    Bottom actions
  --------------------------------------------------------------------------- #}
  <section class="card stack tight" aria-label="Next actions">
    <h2 class="h2">Next</h2>
    <p class="muted">
      <a href="/">Search</a> ·
      <a href="/identify/">Identify</a> ·
      <a href="/all/">All pastas</a>
    </p>
  </section>
</main>
