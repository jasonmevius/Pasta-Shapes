---
pagination:
  data: pasta
  size: 1
  alias: item
permalink: "pasta/{{ item.Slug }}/index.html"
layout: layout.njk

eleventyComputed:
  title: "Pasta Shapes: {{ item.ShapeName }}"
  description: "{% if item.Synonyms %}Aliases: {{ item.Synonyms | truncate(140) }}{% else %}What {{ item.ShapeName }} looks like, plus key shape attributes.{% endif %}"
---

{# =============================================================================
  pasta/detail.njk
  ------------------------------------------------------------------------------
  PURPOSE
  - Mobile-first individual pasta page.
  - Adds high-ROI sections:
      1) Key tells
      2) Commonly confused with (+ why)
      3) Substitutes (ranked + why)
      4) Pairings (+ why)
      6) Also known as (synonyms)
    Plus optional History + How it's made.

  IMPORTANT COMPATIBILITY NOTE
  - Your current Eleventy/Nunjucks setup does NOT have the `split` filter.
  - This template intentionally avoids split/map/reject/concat and renders
    semicolon-separated fields as clean text blocks for now.
  - After this builds, we can add a tiny Eleventy filter to format lists into
    bullets/chips (recommended), without changing your CSV.
============================================================================= #}

{% set heroUrl = item.ThumbnailImage | pastaHeroUrl(item.PhotoImage) %}

<a class="skip-link" href="#main">Skip to content</a>

<!--
<nav class="breadcrumbs">
  <a href="/">← Back to search</a>
</nav>
-->

{# =============================================================================
  TEMP DEBUG - REMOVE AFTER FIXING
  - Shows exactly what Eleventy sees for this pasta row.
============================================================================= #}
<section class="card stack tight" aria-label="Debug">
  <h2 class="h2">Debug</h2>
  <p class="muted"><strong>ShapeName:</strong> {{ item.ShapeName }}</p>
  <p class="muted"><strong>Slug:</strong> {{ item.Slug }}</p>

  <p class="muted"><strong>HistoryBlurb (raw):</strong> [{{ item.HistoryBlurb }}]</p>
  <p class="muted"><strong>BestFor (raw):</strong> [{{ item.BestFor }}]</p>

  <details>
    <summary class="muted">Show keys that contain "History"</summary>
    <ul class="attr-list">
      {% for k, v in item %}
        {% if "History" in k %}
          <li><strong>{{ k }}:</strong> {{ v }}</li>
        {% endif %}
      {% endfor %}
    </ul>
  </details>
</section>

<main id="main" class="stack">
  {# ---------------------------------------------------------------------------
    Header
  --------------------------------------------------------------------------- #}
  <header class="stack tight">
    <h1 class="h1">{{ item.ShapeName }}</h1>
    {% if item.Category %}
      <p class="muted">{{ item.Category }}</p>
    {% endif %}
  </header>

  {# ---------------------------------------------------------------------------
    Hero Image
  --------------------------------------------------------------------------- #}
  <figure class="card hero">
    <img
      src="{{ heroUrl }}"
      alt="{{ item.ShapeName }}"
      width="1200"
      height="1200"
      loading="eager"
      decoding="async"
    />
  </figure>

  {# ---------------------------------------------------------------------------
    Jump to (only show if there is enough content to justify it)
  --------------------------------------------------------------------------- #}
  {% set hasKeyTells = (item.KeyTells or "") | trim != "" %}
  {% set hasConfused = (item.OftenConfusedWith or "") | trim != "" %}
  {% set hasPairings = (item.ClassicSaucePairings or "") | trim != "" %}
  {% set hasSubs = ((item.SubstitutesClosest or "") | trim != "") or ((item.SubstitutesDecent or "") | trim != "") or ((item.SubstitutesEmergency or "") | trim != "") %}
  {% set hasAliases = (item.Synonyms or "") | trim != "" %}
  {% set hasHistory = (item.HistoryBlurb or "") | trim != "" %}
  {% set showJump = (hasKeyTells and hasConfused) or (hasPairings and hasSubs) or (hasHistory and hasPairings) %}

  {% if showJump %}
    <section class="card stack tight" aria-label="Jump to sections">
      <h2 class="h2">Jump to</h2>
      <p class="muted">
        {% if hasKeyTells %}<a href="#key-tells">Key tells</a>{% endif %}
        {% if hasConfused %} · <a href="#confused-with">Confused with</a>{% endif %}
        {% if hasPairings %} · <a href="#pairings">Pairings</a>{% endif %}
        {% if hasSubs %} · <a href="#substitutes">Substitutes</a>{% endif %}
        {% if hasAliases %} · <a href="#aliases">Aliases</a>{% endif %}
        {% if hasHistory %} · <a href="#history">History</a>{% endif %}
        · <a href="#attributes">Attributes</a>
      </p>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    What it is (short description)
  --------------------------------------------------------------------------- #}
  {% set desc = "" %}
  {% if item.Description %}
    {% set desc = item.Description %}
  {% elif item.KeyDiscriminators %}
    {% set desc = item.KeyDiscriminators %}
  {% endif %}

  {% if desc %}
    <section class="card stack tight" aria-label="Description">
      <h2 class="h2">What it is</h2>
      <p class="muted">{{ desc }}</p>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    Key tells (render as readable text for now; semicolons are OK)
  --------------------------------------------------------------------------- #}
  {% if hasKeyTells %}
    <section id="key-tells" class="card stack tight" aria-label="Key tells">
      <h2 class="h2">Key tells</h2>
      <p class="muted">
        {{ item.KeyTells }}
      </p>
      <p class="muted">
        <small>Tip: these are separated by semicolons right now. We can render them as bullets once we add a small Eleventy filter.</small>
      </p>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    Commonly confused with (+ why)
  --------------------------------------------------------------------------- #}
  {% if hasConfused %}
    <section id="confused-with" class="card stack tight" aria-label="Commonly confused with">
      <h2 class="h2">Commonly confused with</h2>

      <p class="muted">{{ item.OftenConfusedWith }}</p>

      {% if (item.OftenConfusedWithWhy or "") | trim != "" %}
        <p class="muted"><strong>How to tell them apart:</strong> {{ item.OftenConfusedWithWhy }}</p>
      {% endif %}

      <p class="muted">
        Tip: If you’re not sure, try <a href="/identify/">Identify</a> and narrow it down by shape.
      </p>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    Pairings (+ why)
  --------------------------------------------------------------------------- #}
  {% if hasPairings %}
    <section id="pairings" class="card stack tight" aria-label="Pairings">
      <h2 class="h2">Pairings</h2>

      <p class="muted">{{ item.ClassicSaucePairings }}</p>

      {% if (item.ClassicSaucePairingsWhy or "") | trim != "" %}
        <p class="muted"><strong>Why it works:</strong> {{ item.ClassicSaucePairingsWhy }}</p>
      {% endif %}
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    Substitutes (ranked + why)
  --------------------------------------------------------------------------- #}
  {% if hasSubs %}
    <section id="substitutes" class="card stack" aria-label="Substitutes">
      <h2 class="h2">Substitutes</h2>

      <div class="stack tight">
        {% if (item.SubstitutesClosest or "") | trim != "" %}
          <div class="stack tight">
            <p><strong>Closest:</strong> {{ item.SubstitutesClosest }}</p>
            {% if (item.SubstitutesClosestWhy or "") | trim != "" %}
              <p class="muted">{{ item.SubstitutesClosestWhy }}</p>
            {% endif %}
          </div>
        {% endif %}

        {% if (item.SubstitutesDecent or "") | trim != "" %}
          <div class="stack tight">
            <p><strong>Decent:</strong> {{ item.SubstitutesDecent }}</p>
            {% if (item.SubstitutesDecentWhy or "") | trim != "" %}
              <p class="muted">{{ item.SubstitutesDecentWhy }}</p>
            {% endif %}
          </div>
        {% endif %}

        {% if (item.SubstitutesEmergency or "") | trim != "" %}
          <div class="stack tight">
            <p><strong>Emergency:</strong> {{ item.SubstitutesEmergency }}</p>
            {% if (item.SubstitutesEmergencyWhy or "") | trim != "" %}
              <p class="muted">{{ item.SubstitutesEmergencyWhy }}</p>
            {% endif %}
          </div>
        {% endif %}
      </div>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    How it's made (light)
  --------------------------------------------------------------------------- #}
  {% if (item.MadeMethod or "") | trim != "" %}
    <section class="card stack tight" aria-label="How it's made">
      <h2 class="h2">How it’s made</h2>
      <p class="muted">{{ item.MadeMethod }}</p>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    Aliases / synonyms
  --------------------------------------------------------------------------- #}
  {% if hasAliases %}
    <section id="aliases" class="card stack tight" aria-label="Also known as">
      <h2 class="h2">Also known as</h2>
      <p class="muted">{{ item.Synonyms }}</p>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    History
  --------------------------------------------------------------------------- #}
  {% if hasHistory %}
    <section id="history" class="card stack tight" aria-label="History">
      <h2 class="h2">History</h2>
      <p class="muted">{{ item.HistoryBlurb }}</p>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    Attributes (collapsible reference)
  --------------------------------------------------------------------------- #}
  <section id="attributes" class="card stack" aria-label="Shape attributes">
    <h2 class="h2">Shape attributes</h2>

    <details>
      <summary class="muted">View full attribute list</summary>

      <ul class="attr-list">
        {% if item.Type %}<li><strong>Type:</strong> {{ item.Type }}</li>{% endif %}
        {% if item.PrimaryGeometry %}<li><strong>Primary geometry:</strong> {{ item.PrimaryGeometry }}</li>{% endif %}
        {% if item.SizeClass %}<li><strong>Size:</strong> {{ item.SizeClass }}</li>{% endif %}

        {% if item.IsHollow %}<li><strong>Hollow:</strong> {{ item.IsHollow }}</li>{% endif %}
        {% if item.IsRidged %}<li><strong>Ridged:</strong> {{ item.IsRidged }}</li>{% endif %}
        {% if item.IsTwisted %}<li><strong>Twisted:</strong> {{ item.IsTwisted }}</li>{% endif %}
        {% if item.IsCurved %}<li><strong>Curved:</strong> {{ item.IsCurved }}</li>{% endif %}
        {% if item.IsStuffed %}<li><strong>Stuffed:</strong> {{ item.IsStuffed }}</li>{% endif %}

        {% if item.CityOrRegionMostAssociated and item.CityOrRegionMostAssociated != "Unknown" %}
          <li><strong>City/Region:</strong> {{ item.CityOrRegionMostAssociated }}</li>
        {% endif %}

        {% if item.EarliestAttestedMention and item.EarliestAttestedMention != "Unknown" %}
          <li><strong>Earliest mention:</strong> {{ item.EarliestAttestedMention }}</li>
        {% endif %}
      </ul>
    </details>
  </section>

  {# ---------------------------------------------------------------------------
    Bottom actions
  --------------------------------------------------------------------------- #}
  <section class="card stack tight" aria-label="Next actions">
    <h2 class="h2">Next</h2>
    <p class="muted">
      <a href="/">Search</a> ·
      <a href="/identify/">Identify</a> ·
      <a href="/all/">All pastas</a>
    </p>
  </section>
</main>
