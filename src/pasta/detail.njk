---
pagination:
  data: pasta
  size: 1
  alias: item
permalink: "pasta/{{ item.Slug }}/index.html"
layout: layout.njk

eleventyComputed:
  title: "Pasta Shapes: {{ item.ShapeName }}"
  description: "{% if item.Synonyms %}Aliases: {{ item.Synonyms | truncate(140) }}{% else %}What {{ item.ShapeName }} looks like, plus key shape attributes.{% endif %}"
---

{# =============================================================================
  detail.njk
  ------------------------------------------------------------------------------
  PURPOSE
  - Individual pasta detail page optimized for Mobile (fast scan + high ROI info).
  - Adds value beyond “me-too” encyclopedia content by prioritizing:
      1) Key tells (for identification)
      2) Commonly confused with (disambiguation)
      3) Substitutes (ranked, practical)
      4) Sauce/dish pairings + why (geometry -> function)
      6) Names/aliases (synonyms, misspellings)
  - Keeps “Shape attributes” as a secondary / collapsible reference section.

  DATA EXPECTATIONS (CSV columns)
  - ShapeName, Slug, Category, Type, PrimaryGeometry, SizeClass
  - ThumbnailImage, PhotoImage (for hero image)
  - Synonyms
  - Description (or KeyDiscriminators as a fallback)
  - KeyTells (semicolon-delimited list recommended)
  - OftenConfusedWith (semicolon-delimited list)
  - OftenConfusedWithWhy (semicolon-delimited list, aligned to OftenConfusedWith)
  - ClassicSaucePairings (semicolon-delimited list)
  - ClassicSaucePairingsWhy (semicolon-delimited list, aligned to ClassicSaucePairings)
  - MadeMethod (e.g., extruded / rolled-cut / sheet formed / stuffed)
  - HistoryBlurb (1–2 sentence micro-history)
  - SubstitutesClosest / SubstitutesDecent / SubstitutesEmergency
  - SubstitutesClosestWhy / SubstitutesDecentWhy / SubstitutesEmergencyWhy

  IMPORTANT: List fields are assumed to be semicolon-separated.
  - Example: "Rigatoni; Ziti; Mostaccioli"
  - Matching Why fields should follow the same order, also separated by semicolons.

  LINKING BEHAVIOR
  - This template attempts to link related pastas (confused-with / substitutes) by
    searching for a matching ShapeName inside the full pasta dataset (data.pasta).
  - If no match is found, it gracefully falls back to plain text.

  ACCESSIBILITY
  - Uses semantic sections, headings, and a skip link.
  - The optional "Jump to" nav helps Mobile users move quickly.

  STYLE NOTES
  - This file leans on your existing CSS classes: card, stack, tight, muted, h1/h2.
  - If you want “chip rows” and a more polished feel, we can add a small CSS block
    later (recommended), but this works as-is.
============================================================================= #}

{% set heroUrl = item.ThumbnailImage | pastaHeroUrl(item.PhotoImage) %}

{# -----------------------------------------------------------------------------
  Helper: Parse semicolon-separated list into a trimmed array.
----------------------------------------------------------------------------- #}
{% set _sep = ";" %}

{% set keyTells = (item.KeyTells or "") | split(_sep) | map("trim") | reject("equalto", "") %}
{% set confused = (item.OftenConfusedWith or "") | split(_sep) | map("trim") | reject("equalto", "") %}
{% set confusedWhy = (item.OftenConfusedWithWhy or "") | split(_sep) | map("trim") | reject("equalto", "") %}

{% set pairings = (item.ClassicSaucePairings or "") | split(_sep) | map("trim") | reject("equalto", "") %}
{% set pairingsWhy = (item.ClassicSaucePairingsWhy or "") | split(_sep) | map("trim") | reject("equalto", "") %}

{# Substitutes are single fields (but may still be semicolon lists in the future).
   For now, treat them as a single “headline” value. #}
{% set subClosest = (item.SubstitutesClosest or "") | trim %}
{% set subDecent = (item.SubstitutesDecent or "") | trim %}
{% set subEmergency = (item.SubstitutesEmergency or "") | trim %}

{% set subClosestWhy = (item.SubstitutesClosestWhy or "") | trim %}
{% set subDecentWhy = (item.SubstitutesDecentWhy or "") | trim %}
{% set subEmergencyWhy = (item.SubstitutesEmergencyWhy or "") | trim %}

{# -----------------------------------------------------------------------------
  Helper: Find a pasta row by ShapeName for linking.
  - Nunjucks doesn’t have a native function definition here, so we do a small
    inline search when rendering each related item.
----------------------------------------------------------------------------- #}

<a class="skip-link" href="#main">Skip to content</a>

<nav class="breadcrumbs">
  <a href="/">← Back to search</a>
</nav>

<main id="main" class="stack">
  {# ---------------------------------------------------------------------------
    Header: Name + category + optional short descriptor line
  --------------------------------------------------------------------------- #}
  <header class="stack tight">
    <h1 class="h1">{{ item.ShapeName }}</h1>
    {% if item.Category %}
      <p class="muted">{{ item.Category }}</p>
    {% endif %}
  </header>

  {# ---------------------------------------------------------------------------
    Hero image: large, clear, fast recognition
  --------------------------------------------------------------------------- #}
  <figure class="card hero">
    <img
      src="{{ heroUrl }}"
      alt="{{ item.ShapeName }}"
      width="1200"
      height="1200"
      loading="eager"
      decoding="async"
    />
  </figure>

  {# ---------------------------------------------------------------------------
    Optional Jump Nav (Mobile-friendly)
    - Only show if at least two of the key sections exist.
  --------------------------------------------------------------------------- #}
  {% set hasKeyTells = keyTells | length > 0 %}
  {% set hasConfused = confused | length > 0 %}
  {% set hasPairings = pairings | length > 0 %}
  {% set hasSubs = subClosest or subDecent or subEmergency %}
  {% set hasHistory = item.HistoryBlurb %}
  {% set showJump = (hasKeyTells and hasConfused) or (hasPairings and hasSubs) or (hasHistory and hasPairings) %}

  {% if showJump %}
    <section class="card stack tight" aria-label="Jump to sections">
      <h2 class="h2">Jump to</h2>
      <p class="muted">
        <a href="#key-tells">Key tells</a>
        {% if hasConfused %} · <a href="#confused-with">Confused with</a>{% endif %}
        {% if hasPairings %} · <a href="#pairings">Pairings</a>{% endif %}
        {% if hasSubs %} · <a href="#substitutes">Substitutes</a>{% endif %}
        {% if item.Synonyms %} · <a href="#aliases">Aliases</a>{% endif %}
        {% if hasHistory %} · <a href="#history">History</a>{% endif %}
        · <a href="#attributes">Attributes</a>
      </p>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    Description: short “what it is” (fallbacks allowed)
  --------------------------------------------------------------------------- #}
  {% set desc = "" %}
  {% if item.Description %}
    {% set desc = item.Description %}
  {% elif item.KeyDiscriminators %}
    {% set desc = item.KeyDiscriminators %}
  {% endif %}

  {% if desc %}
    <section class="card stack tight" aria-label="Description">
      <h2 class="h2">What it is</h2>
      <p class="muted">{{ desc }}</p>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    Key tells: the fastest “confirm you’ve got the right shape” bullets
  --------------------------------------------------------------------------- #}
  {% if hasKeyTells %}
    <section id="key-tells" class="card stack" aria-label="Key tells">
      <h2 class="h2">Key tells</h2>
      <ul class="attr-list">
        {% for t in keyTells %}
          <li>{{ t }}</li>
        {% endfor %}
      </ul>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    Commonly confused with: disambiguation (high ROI)
    - Renders as a simple list of links where possible.
    - If OftenConfusedWithWhy aligns, show a short differentiator under each.
  --------------------------------------------------------------------------- #}
  {% if hasConfused %}
    <section id="confused-with" class="card stack" aria-label="Commonly confused with">
      <h2 class="h2">Commonly confused with</h2>

      <ul class="stack tight">
        {% for name in confused %}
          {% set match = (pasta | selectattr("ShapeName", "equalto", name) | first) %}
          <li class="stack tight">
            {% if match and match.Slug %}
              <a href="/pasta/{{ match.Slug }}/">{{ name }}</a>
            {% else %}
              <span>{{ name }}</span>
            {% endif %}

            {# If a corresponding "why" exists for this index, show it. #}
            {% if confusedWhy[loop.index0] %}
              <p class="muted">{{ confusedWhy[loop.index0] }}</p>
            {% endif %}
          </li>
        {% endfor %}
      </ul>

      <p class="muted">
        Tip: If you’re not sure, try <a href="/identify/">Identify</a> and narrow it down by shape.
      </p>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    Pairings + why: “geometry -> function” explanation (differentiator)
  --------------------------------------------------------------------------- #}
  {% if hasPairings %}
    <section id="pairings" class="card stack" aria-label="Best pairings">
      <h2 class="h2">Pairings</h2>

      <ul class="stack tight">
        {% for p in pairings %}
          <li class="stack tight">
            <strong>{{ p }}</strong>
            {% if pairingsWhy[loop.index0] %}
              <p class="muted">{{ pairingsWhy[loop.index0] }}</p>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    Substitutes: ranked practical swaps (closest / decent / emergency)
  --------------------------------------------------------------------------- #}
  {% if hasSubs %}
    <section id="substitutes" class="card stack" aria-label="Substitutes">
      <h2 class="h2">Substitutes</h2>

      <ul class="stack tight">
        {% if subClosest %}
          <li class="stack tight">
            <strong>Closest:</strong>
            {% set m1 = (pasta | selectattr("ShapeName", "equalto", subClosest) | first) %}
            {% if m1 and m1.Slug %}
              <a href="/pasta/{{ m1.Slug }}/">{{ subClosest }}</a>
            {% else %}
              <span>{{ subClosest }}</span>
            {% endif %}
            {% if subClosestWhy %}
              <p class="muted">{{ subClosestWhy }}</p>
            {% endif %}
          </li>
        {% endif %}

        {% if subDecent %}
          <li class="stack tight">
            <strong>Decent:</strong>
            {% set m2 = (pasta | selectattr("ShapeName", "equalto", subDecent) | first) %}
            {% if m2 and m2.Slug %}
              <a href="/pasta/{{ m2.Slug }}/">{{ subDecent }}</a>
            {% else %}
              <span>{{ subDecent }}</span>
            {% endif %}
            {% if subDecentWhy %}
              <p class="muted">{{ subDecentWhy }}</p>
            {% endif %}
          </li>
        {% endif %}

        {% if subEmergency %}
          <li class="stack tight">
            <strong>Emergency:</strong>
            {% set m3 = (pasta | selectattr("ShapeName", "equalto", subEmergency) | first) %}
            {% if m3 and m3.Slug %}
              <a href="/pasta/{{ m3.Slug }}/">{{ subEmergency }}</a>
            {% else %}
              <span>{{ subEmergency }}</span>
            {% endif %}
            {% if subEmergencyWhy %}
              <p class="muted">{{ subEmergencyWhy }}</p>
            {% endif %}
          </li>
        {% endif %}
      </ul>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    How it's made: keep it lightweight (single line if available)
  --------------------------------------------------------------------------- #}
  {% if item.MadeMethod %}
    <section class="card stack tight" aria-label="How it's made">
      <h2 class="h2">How it’s made</h2>
      <p class="muted">{{ item.MadeMethod }}</p>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    Aliases / synonyms: structured, easy to scan
  --------------------------------------------------------------------------- #}
  {% if item.Synonyms %}
    <section id="aliases" class="card stack tight" aria-label="Also known as">
      <h2 class="h2">Also known as</h2>
      <p class="muted">{{ item.Synonyms }}</p>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    History: 1–2 sentence micro-blurb
  --------------------------------------------------------------------------- #}
  {% if item.HistoryBlurb %}
    <section id="history" class="card stack tight" aria-label="History">
      <h2 class="h2">History</h2>
      <p class="muted">{{ item.HistoryBlurb }}</p>
    </section>
  {% endif %}

  {# ---------------------------------------------------------------------------
    Attributes: keep as a reference section (collapsible to reduce scroll fatigue)
  --------------------------------------------------------------------------- #}
  <section id="attributes" class="card stack" aria-label="Shape attributes">
    <h2 class="h2">Shape attributes</h2>

    <details>
      <summary class="muted">View full attribute list</summary>

      <ul class="attr-list">
        {% if item.Type %}<li><strong>Type:</strong> {{ item.Type }}</li>{% endif %}
        {% if item.PrimaryGeometry %}<li><strong>Primary geometry:</strong> {{ item.PrimaryGeometry }}</li>{% endif %}
        {% if item.SizeClass %}<li><strong>Size:</strong> {{ item.SizeClass }}</li>{% endif %}

        {% if item.IsHollow %}<li><strong>Hollow:</strong> {{ item.IsHollow }}</li>{% endif %}
        {% if item.IsRidged %}<li><strong>Ridged:</strong> {{ item.IsRidged }}</li>{% endif %}
        {% if item.IsTwisted %}<li><strong>Twisted:</strong> {{ item.IsTwisted }}</li>{% endif %}
        {% if item.IsCurved %}<li><strong>Curved:</strong> {{ item.IsCurved }}</li>{% endif %}
        {% if item.IsStuffed %}<li><strong>Stuffed:</strong> {{ item.IsStuffed }}</li>{% endif %}

        {% if item.CityOrRegionMostAssociated and item.CityOrRegionMostAssociated != "Unknown" %}
          <li><strong>City/Region:</strong> {{ item.CityOrRegionMostAssociated }}</li>
        {% endif %}

        {% if item.EarliestAttestedMention and item.EarliestAttestedMention != "Unknown" %}
          <li><strong>Earliest mention:</strong> {{ item.EarliestAttestedMention }}</li>
        {% endif %}

        {% if item.SourceLink %}
          <li>
            <strong>Source:</strong>
            <a href="{{ item.SourceLink }}" rel="noopener">Link</a>
          </li>
        {% endif %}
      </ul>
    </details>
  </section>

  {# ---------------------------------------------------------------------------
    Bottom actions: keep the user moving (Mobile-friendly)
  --------------------------------------------------------------------------- #}
  <section class="card stack tight" aria-label="Next actions">
    <h2 class="h2">Next</h2>
    <p class="muted">
      <a href="/">Search</a> ·
      <a href="/identify/">Identify</a> ·
      <a href="/all/">All pastas</a>
    </p>
  </section>
</main>
